{
  "hash": "617bb13e20ec081d43c585fd80675156",
  "result": {
    "markdown": "::: {.cell execution_count=1}\n``` {.julia .cell-code}\ninclude(\"notebooks/setup.jl\")\neval(setup_notebooks);\n```\n:::\n\n\n# Synthetic data\n\n::: {.cell execution_count=2}\n``` {.julia .cell-code}\n# Data:\ndatasets = Dict(\n    :linearly_separable => load_linearly_separable(),\n    :overlapping => load_overlapping(),\n    :moons => load_moons(),\n    :circles => load_circles(),\n    :multi_class => load_multi_class(),\n)\n\n# Hyperparameters:\ncvgs = [0.5, 0.75, 0.95]\ntemps = [0.01, 0.1, 1.0]\nΛ = [0.0, 0.1, 1.0, 10.0]\nl2_λ = 0.1\n\n# Classifiers:\nepochs = 250\nlink_fun = relu\nlogreg = NeuralNetworkClassifier(builder=MLJFlux.Linear(σ=link_fun), epochs=epochs)\nmlp = NeuralNetworkClassifier(builder=MLJFlux.MLP(hidden=(32,), σ=link_fun), epochs=epochs)\nensmbl = EnsembleModel(model=mlp, n=5)\nclassifiers = Dict(\n    # :logreg => logreg,\n    :mlp => mlp,\n    # :ensmbl => ensmbl,\n)\n\n# Search parameters:\ntarget = 2\nfactual = 1\nmax_iter = 50\ngradient_tol = 1e-2\nopt = Descent(0.01)\n```\n:::\n\n\n\n\n\n\n::: {.cell execution_count=5}\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-1.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-2.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-3.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-4.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-5.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-6.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-7.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-8.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-9.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-10.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-11.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-12.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-13.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-14.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-15.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-16.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-17.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-18.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-19.svg){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-6-output-20.svg){}\n:::\n:::\n\n\n## Benchmark\n\n::: {.cell execution_count=6}\n``` {.julia .cell-code}\n# Benchmark generators:\ngenerators = Dict(\n    :wachter => GenericGenerator(opt=opt, λ=l2_λ),\n    :revise => REVISEGenerator(opt=opt, λ=l2_λ),\n    :greedy => GreedyGenerator(),\n)\n\n# Untrained Models:\nmodels = Dict(Symbol(\"cov$(Int(100*cov))\") => ECCCE.ConformalModel(conformal_model(mlp; method=:simple_inductive, coverage=cov)) for cov in cvgs)\n\n# Measures:\nmeasures = [\n    CounterfactualExplanations.distance,\n    ECCCE.distance_from_energy,\n    ECCCE.distance_from_targets,\n    CounterfactualExplanations.validity,\n]\n```\n:::\n\n\n### Single CE\n\n\n\n\n\n::: {.cell execution_count=9}\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-2.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-3.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-4.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-5.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-6.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-7.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-8.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-9.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-10.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-11.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-12.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-13.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-14.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-10-output-15.png){}\n:::\n:::\n\n\n### Full Benchmark\n\n::: {.cell execution_count=10}\n``` {.julia .cell-code}\nbmks = []\nfor (dataname, dataset) in datasets\n    for λ in Λ, temp in temps\n        _generators = deepcopy(generators)\n        _generators[:cce] = ECCCEGenerator(temp=temp, λ=[l2_λ,λ], opt=opt)\n        _generators[:energy] = ECCCE.EnergyDrivenGenerator(λ=[l2_λ,λ], opt=opt)\n        _generators[:target] = ECCCE.TargetDrivenGenerator(λ=[l2_λ,λ], opt=opt)\n        bmk = benchmark(\n            dataset; \n            models=deepcopy(models), \n            generators=_generators, \n            measure=measures,\n            suppress_training=false, dataname=dataname,\n            n_individuals=5,\n            initialization=:identity,\n        )\n        bmk.evaluation.λ .= λ\n        bmk.evaluation.temperature .= temp\n        push!(bmks, bmk)\n    end\nend\nbmk = reduce(vcat, bmks)\n```\n:::\n\n\n::: {.cell execution_count=11}\n``` {.julia .cell-code}\nCSV.write(joinpath(output_path, \"synthetic_benchmark.csv\"), bmk())\n```\n:::\n\n\n::: {.cell execution_count=12}\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-2.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-3.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-4.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-5.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-6.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-7.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-8.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-9.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-10.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-11.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-12.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-13.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-14.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-15.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-16.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-17.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-18.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-19.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-20.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-21.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-22.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-23.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-24.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-25.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-26.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-27.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-28.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-29.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-30.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-31.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-32.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-33.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-34.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-35.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-36.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-37.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-38.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-39.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-40.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-41.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-42.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-43.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-44.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-45.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-46.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-47.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-48.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-49.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-50.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-51.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-52.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-53.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-54.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-55.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-56.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-57.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-58.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-59.png){}\n:::\n\n::: {.cell-output .cell-output-display}\n![](synthetic_files/figure-html/cell-13-output-60.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "synthetic_files"
    ],
    "filters": [],
    "includes": {}
  }
}