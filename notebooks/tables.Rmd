
```{r}
library(data.table)
library(kableExtra)
```

```{r}
files <- list.files("artifacts/results/")
dt <- lapply(files[grepl("_benchmark.csv", files)], function(x) {
    fread(file.path("artifacts/results/", x))
})
dt <- Reduce(function(x,y) {rbind(x,y, fill=TRUE)}, dt)
dt[,ce:=NULL]
synth <- c("Moons", "Circles", "Linearly Separable")
dt[,source:=ifelse(dataname %in% synth, "synthetic", "real")]
```

## Main tables

```{r}
measures <- c("distance_from_energy", "distance_from_targets")
tab <- dt[
    variable %in% measures & source=="real",
    .(
      value=sprintf("%1.2f (%1.2f)", mean(value), sd(value)),
      val = mean(value),
      std = sd(value)
    ),
    .(dataname, generator, model, variable)
]
tab[,min_val:=val==min(val),.(model, dataname, variable)]
tab[,two_std_wachter:=val+2*std<val[generator=="Wachter"],.(model, dataname, variable)]
tab[,one_std_wachter:=val+1*std<val[generator=="Wachter"],.(model, dataname, variable)]
tab[one_std_wachter==T,value:=paste0(value,"*")]
tab[two_std_wachter==T,value:=paste0(value,"*")]
tab$value <- cell_spec(tab$value, "latex", bold=tab$min_val)
tab[,val:=NULL]
tab[,std:=NULL]
tab[,min_val:=NULL]
tab[,two_std_wachter:=NULL]
tab[,one_std_wachter:=NULL]
n_data <- length(unique(tab$dataname))
tab <- dcast(tab, model + generator ~ dataname + variable)
col_names <- c(
  "Model",
  "Generator",
  rep(c("Non-conformity ↓","Implausibility ↓"),n_data)
)
kbl(
  tab, caption = "Results for real-world datasets. Standard deviations across samples are shown in parentheses. Best outcomes are highlighted in bold. Asterisks indicate that the given value is more than one (*) or two (**) standard deviations away from the baseline (Wachter). \\label{tab:results-real} \\newline", 
  align = "c", col.names=col_names, booktabs = T, escape=F, 
  format="latex", linesep = c("", "", "", "\\addlinespace") 
) %>%
  kable_styling(latex_options = c("scale_down")) %>%
  kable_paper(full_width = F) %>%
  add_header_above(c(" " = 2, "California Housing" = 2, "GMSC" = 2, "MNIST" = 2)) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:2, latex_hline = "major", valign = "middle") %>%
  save_kable("paper/contents/table_real.tex")
```

```{r}
measures <- c("distance_from_energy", "distance_from_targets")
tab <- dt[
    variable %in% measures & source=="synthetic",
    .(
      value=sprintf("%1.2f (%1.2f)", mean(value), sd(value)),
      val = mean(value),
      std = sd(value)
    ),
    .(dataname, generator, model, variable)
]
tab[,min_val:=val==min(val),.(model, dataname, variable)]
tab[,two_std_wachter:=val+2*std<val[generator=="Wachter"],.(model, dataname, variable)]
tab[,one_std_wachter:=val+1*std<val[generator=="Wachter"],.(model, dataname, variable)]
tab[one_std_wachter==T,value:=paste0(value,"*")]
tab[two_std_wachter==T,value:=paste0(value,"*")]
tab$value <- cell_spec(tab$value, "latex", bold=tab$min_val)
tab[,val:=NULL]
tab[,std:=NULL]
tab[,min_val:=NULL]
tab[,two_std_wachter:=NULL]
tab[,one_std_wachter:=NULL]
n_data <- length(unique(tab$dataname))
tab <- dcast(tab, model + generator ~ dataname + variable)
col_names <- c(
  "Model",
  "Generator",
  rep(c("Non-conformity ↓","Implausibility ↓"),n_data)
)
kbl(
  tab, caption = "Results for synthetic datasets. Standard deviations across samples are shown in parentheses. Best outcomes are highlighted in bold. Asterisks indicate that the given value is more than one (*) or two (**) standard deviations away from the baseline (Wachter). \\label{tab:results-synth} \\newline", 
  align = "c", col.names=col_names, booktabs = T, escape=F, 
  format="latex", linesep = c("", "", "", "\\addlinespace") 
) %>%
  kable_styling(latex_options = c("scale_down")) %>%
  kable_paper(full_width = F) %>%
  add_header_above(c(" " = 2, "Circles" = 2, "Linearly Separable" = 2, "Moons" = 2)) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1:2, latex_hline = "major", valign = "middle") %>%
  save_kable("paper/contents/table_synth.tex")
```